<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Survey</title>
    <!-- Latest compiled and minified CSS & JS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <style>
    </style>
</head>

<body>

    <div class="container">
        <div>
            <h1 class="text-left">Survey Questions</h1>
            <hr>
            <form id="form">
                <h3>About You</h3>
                Name (Required)
                <br>
                <input type="text" id="name" class="input">
                <br> Link to photo image (Required)
                <br>
                <input type="text" id="photo" class="input">
            </form>
            
        </div>
        <hr>
        <div id="questions"></div>
        <br>
        <div class="text-left">
            <button type="submit" class="btn btn-primary btn-md" id="submit-btn" data-toggle="modal" data-target="#modal">
                <span class="fa fa-fire"></span>Submit</button>
        </div>

        <!-- modal -->
        <div class="modal" tabindex="-1" role="dialog" id="modal">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title">Your Results!</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>
                <div class="modal-body">
                  <p>We think your furrever friend could be: </p>
                  <div class="row">
                      <div class="col-sm-6">
                        <img src="" class="photo" alt="best match photo">
                      </div>
                      <div class="col-sm-6">
                          <h2 id="matchName"></h2>
                          <p id="matchType"></p>
                          <p id="matchAge"></p>
                      </div>
                  </div>
                  
                </div>
                <div class="modal-footer">
                  <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
              </div>
            </div>
          </div>
    </div>
    





    <script type="text/javascript">
        $(document).ready(function () {

            //To Do:
            //fix select btn options bug
            //grab value of score chosen for each question, push value to scores array
            //send newFriend data to friends.js


            var questions = [
                "I love hiking, running, or just being active outdoors",
                "When I get home from work I want to chill on the couch.",
                "I live in a house with a large yard.",
                "I have other pets that would love a new sibling.",
                "I work long hours each day.",
                "I have expensive furniture"
                // "It is often difficult for you to relate to other people’s feelings.",
                // "In a discussion, truth should be more important than people’s sensitivities.",
                // "You rarely get carried away by fantasies and ideas.",
                // "You think that everyone’s views should be respected regardless of whether they are supported by facts or not.",
                // "You feel more energetic after spending time with a group of people."
            ];
            
            var surveyResults = {};

            // Render each question to the page
            function renderQuestion() {
                for (var i = 0; i < (questions.length); i++) {

                    //create head and question, append to questions div
                    var heading = $("<h3>").text("Question " + (i+1));
                    var question = $("<p>").text(questions[i]);

                    $("#questions").append(heading);
                    $("#questions").append(question);
                    
                    createDropdown(i+1);       
                }
            }
           
            // Create dropdown list 
            function createDropdown(questionNum){
                var selectBtn = $("<select>").attr("class", "selectBtn");
                    selectBtn.attr("data-value", questionNum.toString());
                    selectBtn.append($("<option value='' disabled selected></option"))
                    // <option value="" disabled selected>Select your option</option>
                var scoreOptions = {
                    1: 1,
                    2: 2,
                    3: 3,
                    4: 4,
                    5: 5
                };
                // For each score option, append to select button
                $.each(scoreOptions, function (val, text) {
                    selectBtn.append($('<option></option>').val(val).html(text));
                });
                // Append select button to questions div
                $("#questions").append(selectBtn);
            }
    
            renderQuestion();



            //Function to capture score option selected for each question
                //push score option to array
            $(".selectBtn").on("change", function(event){
                var questionNum = $(this).attr("data-value");
                var score = event.target.value;
                surveyResults[questionNum.toString()] = score;
            })



            // On click event for submit button
            $("#submit-btn").on("click", function (event) {
                event.preventDefault();
                console.log(surveyResults);

                // Create new friend object
                var newFriend = {
                    name: $("#name").val().trim(),
                    photo: $("#photo").val().trim(),
                    scores: surveyResults
                };
                console.log("newFriend" + newFriend);

                                                   
                $.post("/api/survey", newFriend)
                    .then(function (data) {
                        console.log(data)
                     $("#matchName").text(data.name);
                     $("#matchType").text(data.type);
                     $("#matchAge").text(data.age);
                     $(".photo").attr("src", data.photo);
                     differenceArray = [];
                    });

                $(".input").val(" ");
                $(".selectBtn").val(" ");
            });

    
        });
    </script>


</body>

</html>